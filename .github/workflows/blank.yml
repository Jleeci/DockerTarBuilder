name: Batch Download and Release Videos

on:
  workflow_dispatch:
    inputs:
      urls:
        description: '请填写docker镜像名称,多个用英文逗号分开'
        required: true
  push:
    branches:
      - main  # 触发工作流的分支，可以根据需要更改

jobs:
  build:
    runs-on: ubuntu-latest  # 运行工作流的虚拟环境

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg zip
    - name: Create videos directory
      run: |
        pwd
        sudo mkdir -p /videos
        
    - name: Batch download videos
      run: |
        VIDEO_URLS="${{ github.event.inputs.urls }}"
        index=1;
        for url in $VIDEO_URLS; do
          ffmpeg -threads 3 -i "$url"  -c copy  /videos/$index.mp4
          ((index++))
        done

    - name: Create zip file
      run: |
        cd /
        zip -r videos.zip /vides/* # 假设所有视频都是 mp4 格式

    - name: Create release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        draft: false
        prerelease: false

    - name: Upload zip to release
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: /videos.zip
        asset_name: videos.zip
        asset_content_type: application/zip
